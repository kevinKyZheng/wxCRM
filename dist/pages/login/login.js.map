{"version":3,"sources":["pages/login/login.js"],"names":["app","getApp","Page","data","username","password","autoLogin","onLoad","that","wx","getStorage","key","success","res","console","log","setData","tapLoginBtn","updateLocation","lat","latitude","lon","longtitude","name","address","getAddress","fail","e","hideLoading","getWeatherData","openLocation","showToast","title","icon","duration","showLoading","request","url","userPass","userName","source","method","header","setStorage","globalData","userInfo","switchTab","complete","usernameConfirm","detail","value","passwordConfirm","passwordMD5","substring"],"mappings":"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","file":"login.js","sourcesContent":["const app = getApp()\nimport {geocode} from '../../lib/api';\nimport {\n  hexMD5\n} from '../../utils/md5.js';\nPage({\n  data: {\n    username: \"\",\n    password: \"\",\n    autoLogin: true\n  },\n  onLoad: function () {\n    var that = this\n    // wx.getStorage({\n    //   key:\"historyLogin\",\n    //   success:function(res){\n    //     console.log(res)\n    //     console.log(res.username)\n    //     that.setData({\n    //       // username:res.username,\n    //       // password:res[\"password\"]\n    //     })\n    //   }\n    // })\n    wx.getStorage({\n      key: \"username\",\n      success: function (res) {\n        console.log(res)\n        that.setData({\n          username: res\n        })\n      }\n    })\n    wx.getStorage({\n      key: \"password\",\n      success: function (res) {\n        console.log(res)\n        that.setData({\n          password: res\n        })\n      }\n    })\n    this.tapLoginBtn()\n  },\n  // tapLoginBtn: function () {\n  //   console.log(\"123\")\n  //   wx.getLocation({\n  //     type:\"gcj02\",\n  //     success:this.updateLocation,\n  //     fail:(e)=>{\n  //       this.openLocation()\n  //     }\n  //   })\n  // },\n  updateLocation(res){\n    console.log(\"111\")\n    console.log(res)\n    let {latitude:lat,longtitude:lon,name} = res\n    let data={\n      lat,\n      lon\n    }\n    if (name) {\n      data.address = name\n    }\n    console.log(lat)\n    // this.setData(data)\n    this.getAddress(lat, lon, name)\n  },\n  getAddress(lat,lon,name){\n    let fail = (e) => {\n      // console.log(e)\n      this.setData({\n        address: name || '北京市海淀区西二旗北路'\n      })\n      wx.hideLoading()\n      this.getWeatherData()\n    }\n    geocode(\n      lat,\n      lon,\n      (res)=>{\n        console.log(res)\n        // let result = (res.data || {}).result\n        // console.log(result)\n      },\n      // fail,\n      fail\n    )\n  },\n  openLocation:function(){\n    wx.showToast({\n      title: '检测到您未授权使用位置权限，请先开启哦',\n      icon: 'none',\n      duration: 3000\n    })\n  },\n  tapLoginBtn:function(){\n      console.log(this.data.username)\n      console.log(this.data.password)\n      var that = this\n      wx.showLoading({\n        title:\"加载中\"\n      })\n      // wx.login({\n      //   success:(res)=>{\n      //     console.log(res)\n      //   }\n      // })\n      wx.request({\n          url: 'http://crmapi.chinawutong.com/api/Login/UserLogin', //仅为示例，并非真实的接口地址\n          data: {\n            userPass: '91e31e2ef2076caf',\n            userName: 'test_wtbuzhang',\n            source: 'iOS'\n            // userPass: that.data.password,\n            // userName: that.data.username,\n            // source: 'iOS'\n          },\n          method:\"POST\",\n          header: {\n            'content-type': 'application/json' // 默认值\n          },\n          success (res) {\n            wx.hideLoading()\n            //\n            wx.setStorage({\n              // key:\"historyLogin\",\n              // data:{\"username\":that.data.username,\"password\":that.data.password}\n              key:\"password\",\n              data:that.data.password\n            })\n            wx.setStorage({\n              key:\"username\",\n              data:that.data.username,\n            })\n            app.globalData.userInfo[\"userId\"] = res.data[\"data\"][\"UserID\"];\n            app.globalData.userInfo[\"token\"] = res.data[\"data\"][\"Token\"];\n            app.globalData.userInfo[\"power\"] = res.data[\"data\"][\"UserPower\"];\n            app.globalData.userInfo[\"username\"] = res.data[\"data\"][\"RoleName\"];\n            console.log(res);\n            wx.switchTab({\n              url: '../root/root',\n              success: function(res){\n                // success\n              },\n              fail: function() {\n                // fail\n              },\n              complete: function() {\n                // complete\n              }\n            })\n            console.log(app.globalData.userInfo[\"token\"]);\n            console.log(app.globalData.userInfo[\"userId\"]);\n            console.log(app.globalData.userInfo[\"power\"]);\n          },\n          fail(e){\n            wx.hideLoading()\n            wx.showToast({\n              title:e\n            })\n          },\n          complete(e){\n          }\n      })     \n  },\n  usernameConfirm: function (e) {\n    this.setData({\n      username: e.detail.value\n    })\n  },\n  passwordConfirm: function (e) {\n    var passwordMD5 = hexMD5(e.detail.value).substring(8, 24)\n    console.log(passwordMD5)\n    this.setData({\n      password: passwordMD5\n    })\n  }\n})"]}